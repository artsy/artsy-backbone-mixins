// Generated by CoffeeScript 1.10.0
(function() {
  var ADDRESS_ATTR, TITLE_ATTR, calulateDurationTime, convertToYahooDuration, formatTime, ics;

  ics = require('ics');

  ADDRESS_ATTR = '';

  TITLE_ATTR = '';

  module.exports = function(arg) {
    var address, title;
    address = arg.address, title = arg.title;
    ADDRESS_ATTR = address;
    TITLE_ATTR = title;
    return module.exports.methods;
  };

  module.exports.methods = {
    formatTime: formatTime = function(date) {
      return new Date(date).toISOString().replace(/-|:|\.\d+/g, '');
    },
    calulateDurationTime: calulateDurationTime = function(end, start) {
      var endTime, startTime;
      endTime = new Date(end).getTime();
      startTime = new Date(start).getTime();
      return (endTime - startTime) / (60 * 1000);
    },
    convertToYahooDuration: convertToYahooDuration = function(end, start) {
      var eventDuration, yahooHourDuration, yahooMinuteDuration;
      eventDuration = calulateDurationTime(end, start);
      yahooHourDuration = eventDuration < 600 ? '0' + Math.floor(eventDuration / 60) : Math.floor(eventDuration / 60) + '';
      if ((eventDuration % 60) < 10) {
        yahooMinuteDuration = '0' + (eventDuration % 60);
      } else {
        yahooMinuteDuration = (eventDuration % 60) + '';
      }
      return yahooHourDuration + yahooMinuteDuration;
    },
    googleCalendarUrl: function() {
      var endTime, href, startTime;
      startTime = formatTime(this.get('start_at'));
      endTime = formatTime(this.get('end_at'));
      href = encodeURI(['https://www.google.com/calendar/render', '?action=TEMPLATE', '&text=' + (this.get(TITLE_ATTR) || ''), '&dates=' + (startTime || ''), '/' + (endTime || ''), '&details=' + (this.get('description') || ''), '&location=' + (this.get(ADDRESS_ATTR) || ''), '&sprop=&sprop=name:'].join(''));
      return href;
    },
    yahooCalendarUrl: function() {
      var href, st, yahooEventDuration;
      yahooEventDuration = convertToYahooDuration(this.get('end_at'), this.get('start_at'));
      st = new Date(this.get('start_at')).toISOString().replace(/-|:|\.\d+/g, '');
      href = encodeURI(['http://calendar.yahoo.com/?v=60&view=d&type=20', '&title=' + (this.get(TITLE_ATTR) || ''), '&st=' + st, '&dur=' + (yahooEventDuration || ''), '&desc=' + (this.get('description') || ''), '&in_loc=' + (this.get(ADDRESS_ATTR) || '')].join(''));
      return href;
    },
    icsCalendarUrl: function() {
      var data, description, endTime, eventOptions, href, ref, startTime;
      startTime = new Date(this.get('start_at'));
      endTime = new Date(this.get('end_at'));
      description = (ref = this.get('description')) != null ? ref.replace(/(\r\n|\n|\r)/gm, "") : void 0;
      eventOptions = {
        eventName: this.get(TITLE_ATTR) || '',
        dtstart: startTime || '',
        dtend: endTime || '',
        description: description || '',
        location: this.get(ADDRESS_ATTR) || ''
      };
      data = ics.getEvent(eventOptions);
      data = 'data:text/calendar;charset=utf8,' + data;
      href = encodeURI(data);
      return href;
    }
  };

}).call(this);
